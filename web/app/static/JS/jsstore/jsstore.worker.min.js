/*!
 * @license :jsstore - V4.0.6 - 25/05/2021
 * https://github.com/ujjwalguptaofficial/JsStore
 * Copyright (c) 2021 @Ujjwal Gupta; Licensed MIT
 */
var JsStoreWorker=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}({3:function(e,t,r){"use strict";var n,o,i,u,s,a,c,l,h;r.r(t),r.d(t,"QueryManager",(function(){return Fe})),function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown"}(n||(n={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts"}(u||(u={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled"}(s||(s={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(a||(a={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(h||(h={}));var f,p=function(e){return new Promise(e)};!function(e){e.Create="create",e.Delete="delete"}(f||(f={}));var d,y=function(){function e(e,t){this.autoIncColumnValue={};var r=[];for(var n in e.columns){var o=e.columns[n];o.name=n,o.autoIncrement&&(this.autoIncColumnValue[n]=0),o.primaryKey&&(this.primaryKey=n),o.enableSearch=null==o.enableSearch||o.enableSearch,r.push(o)}this.columns=r,this.name=e.name,this.version=e.version||1,t>this.version&&(this.version=t),this.setState_()}return e.prototype.setState_=function(){this.state=f.Create},e}(),v=function(){function e(){}return e.autoIncrementKey=function(e,t){return"JsStore_"+e+"_"+t+"_Value"},e.set=function(t,r,n){n.tx||n.createTransaction([e.tableName]);var o=n.objectStore(e.tableName);return p((function(e,n){var i=o.put({key:t,value:r});i.onsuccess=function(){e()},i.onerror=n}))},e.get=function(t,r){r.tx||r.createTransaction([e.tableName]);var n=r.objectStore(e.tableName);return p((function(e,o){var i=n.get(r.keyRange(t));i.onsuccess=function(){var t=i.result;e(t&&t.value)},i.onerror=o}))},e.remove=function(t,r){r.tx||r.createTransaction([e.tableName]);var n=r.objectStore(e.tableName);return p((function(e,o){var i=n.delete(r.keyRange(t));i.onsuccess=e,i.onerror=o}))},e.tableName="JsStore_Meta",e.dbSchema="JsStore_DbSchema",e}(),b=function(e){this.name=e.name,e.tables.push({name:v.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=e.tables.map((function(t){return new y(t,e.version)})),this.version=e.version||1},m=function(){function e(e,t){this.type=e,this.info_=t,this.message=this.getMsg_()}return e.prototype.log=function(e){this.status&&console.log(e)},e.prototype.throw=function(){throw this.get()},e.prototype.logError=function(){console.error(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var e;switch(this.type){case n.NotArray:e="Supplied value is not an array";break;case n.UndefinedColumn:e="Column is undefined in Where";break;case n.UndefinedValue:e="Value is undefined in Where";break;case n.UndefinedColumnName:e="Column name is undefined '"+this.info_.TableName+"'";break;case n.UndefinedDbName:e="Database name is not supplied";break;case n.UndefinedColumnValue:e="Column value is undefined";break;case n.NoValueSupplied:e="No value is supplied";break;case n.InvalidOp:e="Invalid Op Value '"+this.info_.Op+"'";break;case n.ColumnNotExist:e=this.info_.isOrder?"Column '"+this.info_.column+"' in order query does not exist":"Column '"+this.info_.column+"' does not exist";break;case n.EnableSearchOff:e="Search is turned off for the Column '"+this.info_.column+"'";break;case n.NullValue:e="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case n.WrongDataType:e="Supplied value for column '"+this.info_.column+"' have wrong data type";break;case n.TableNotExist:e="Table '"+this.info_.tableName+"' does not exist";break;case n.DbNotExist:e="Database with name "+this.info_.dbName+" does not exist";break;case n.NotObject:e="supplied value is not object";break;case n.InvalidOp:e="Invalid Config '"+this.info_.Config+" '";break;case n.DbBlocked:e="database is blocked, cant be deleted right now";break;case n.NullValueInWhere:e="Null/undefined is not allowed in where. Column '"+this.info_.column+"' has null";break;case n.MethodNotExist:e="method "+this.info_+" does not exist.";break;case n.IndexedDbNotSupported:e="Browser does not support indexeddb";break;case n.InvalidJoinQuery:case n.InvalidGroupQuery:case n.InvalidOrderQuery:case n.ImportScriptsFailed:e=this.info_;break;default:this.type||(this.type=n.Unknown),e=this.message}return e},e}(),g=function(){function e(e){this.logger=new m(null),this.db=e}return e.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},e.prototype.createTransactionIfNotExist=function(e,t){this.tx||this.createTransaction(e,t)},e.prototype.createTransaction=function(e,t){var r=this;return void 0===t&&(t=c.ReadWrite),this.tx=this.con.transaction(e,t),p((function(e,t){r.tx.oncomplete=e,r.tx.onabort=e,r.tx.onerror=t}))},e.prototype.keyRange=function(e,t){var r;switch(t){case a.Between:r=IDBKeyRange.bound(e.low,e.high,!1,!1);break;case a.GreaterThan:r=IDBKeyRange.lowerBound(e,!0);break;case a.GreaterThanEqualTo:r=IDBKeyRange.lowerBound(e);break;case a.LessThan:r=IDBKeyRange.upperBound(e,!0);break;case a.LessThanEqualTo:r=IDBKeyRange.upperBound(e);break;default:r=IDBKeyRange.only(e)}return r},e.prototype.objectStore=function(e){return this.tx.objectStore(e)},e.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},e.prototype.close=function(){var e=this;return this.con&&this.con.close(),p((function(t){e.con=null,setTimeout(t,100)}))},e.prototype.initDb=function(){var e=this,t=this.db,r=!1;return p((function(n,o){var i=indexedDB.open(t.name,t.version);i.onsuccess=function(){e.con=i.result,e.con.onversionchange=function(e){e.target.close()},n(r)},i.onerror=function(e){console.error("error",e),o(e)},i.onupgradeneeded=function(e){var n=e.target.result;r=!0;var o=[f.Create,f.Delete];t.tables.forEach((function(e){o.indexOf(e.state)>=0&&function(e){var t=e.primaryKey?{keyPath:e.primaryKey}:{autoIncrement:!0};n.objectStoreNames.contains(e.name)&&n.deleteObjectStore(e.name);var r=n.createObjectStore(e.name,t);e.columns.forEach((function(e){if(e.enableSearch){var t=e.name,n=e.primaryKey?{unique:!0}:{unique:e.unique};n.multiEntry=e.multiEntry;var o=null==e.keyPath?t:e.keyPath;r.createIndex(t,o,n)}}))}(e)}))}}))},e}(),_=function(e){return Promise.all(e)},w=function(e){return Promise.reject(e)},x=function(e){if(e instanceof m)return e.logError(),e.get();var t=void 0;return e.name?(t=new m(e.name)).message=e.message:(t=new m(e.target.error.name)).message=e.target.error.message,t.get()},k=function(){function e(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return e.prototype.table=function(e){var t=e||this.tableName;return this.db.tables.find((function(e){return e.name===t}))},e.prototype.primaryKey=function(e){return this.table(e).primaryKey},e.prototype.getColumnInfo=function(e,t){return this.table(t).columns.find((function(t){return t.name===e}))},e.prototype.onException=function(e,t){return console.error(e),this.util.abortTransaction(),w(function(e,t){return void 0===t&&(t=n.InvalidQuery),e.name=t,x(e)}(e,t))},e}(),T=function(e){if(null==e)return i.Null;var t=typeof e;switch(t){case"object":if(Array.isArray(e))return i.Array;if(e instanceof Date)return i.DateTime}return t},E=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0===e.length;case"number":return isNaN(e)}return!1},S=function(){function e(e,t){this.table=e,this.autoIncrementValue=t}return e.prototype.checkAndModifyValues=function(e){var t,r=this;this.query=e;var n=e.values,o=[];return n.every((function(n,i){return t=r.checkAndModifyValue(n),e.ignore&&t&&(o.push(i),t=null),!t})),o.forEach((function(e){n.splice(e,1)})),{err:t,values:n}},e.prototype.checkAndModifyValue=function(e){var t,r=this;return this.table.columns.every((function(n){return!(t=r.checkAndModifyColumnValue_(n,e))})),t},e.prototype.checkNotNullAndDataType_=function(e,t){return e.notNull&&E(t[e.name])?this.getError(n.NullValue,{ColumnName:e.name}):e.dataType&&!E(t[e.name])&&T(t[e.name])!==e.dataType?this.getError(n.WrongDataType,{column:e.name}):void 0},e.prototype.checkAndModifyColumnValue_=function(e,t){var r=t[e.name];if(e.autoIncrement?E(r)?t[e.name]=++this.autoIncrementValue[e.name]:T(r)===i.Number&&r>this.autoIncrementValue[e.name]&&(this.autoIncrementValue[e.name]=r):void 0!==e.default&&E(r)&&(t[e.name]=e.default),this.query.validation)return this.checkNotNullAndDataType_(e,t)},e.prototype.getError=function(e,t){return new m(e,t)},e}(),q=function(){function e(e){this.table=e}return e.prototype.check=function(e,t){var r,o=this;return typeof e===i.Object?this.table?this.table.columns.every((function(t){return t.name in e&&(r=o.checkByColumn_(t,e[t.name])),!r})):r=new m(n.TableNotExist,{tableName:t}):r=new m(n.NotObject),r},e.prototype.checkByColumn_=function(e,t){if(!0===e.notNull&&E(t))return new m(n.NullValue,{ColumnName:e.name});var r=T(t),o=null!=t;if(e.dataType&&o&&r!==e.dataType&&"object"!==r)return new m(n.WrongDataType,{column:e.name});if(o&&"object"===r){var i=["+","-","*","/","{push}"];for(var u in t)if(i.indexOf(u)<0&&e.dataType&&r!==e.dataType)return new m(n.WrongDataType,{column:e.name})}},e}(),C=function(){function e(e){this.db=e}return e.prototype.validate=function(e,t){switch(e){case u.Select:case u.Remove:case u.Count:return this.checkSelect(t);case u.Insert:return this.checkInsertQuery(t);case u.Update:return this.checkUpdate(t)}},e.prototype.getTable_=function(e){return this.db.tables.find((function(t){return t.name===e}))},e.prototype.isInsertQryValid=function(e){var t,r=this.getTable_(e.into);if(r)switch(T(e.values)){case i.Array:break;case i.Null:t=new m(n.NoValueSupplied);break;default:t=new m(n.NotArray)}else t=new m(n.TableNotExist,{tableName:e.into});return{table:r,log:t}},e.prototype.checkUpdate=function(e){var t=new q(this.getTable_(e.in)).check(e.set,e.in);if(t)return t;if(null!=e.where){if(t=this.checkForNullInWhere_(e))return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkSelect=function(e){if(!this.getTable_(e.from))return new m(n.TableNotExist,{tableName:e.from});if(e.where){var t=this.checkForNullInWhere_(e);if(t)return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkForNullInWhere_=function(e){for(var t in e.where)if(null==e.where[t])return new m(n.NullValueInWhere,{column:t})},e.prototype.addGreatAndLessToNotOp_=function(e){var t=e.where,r=function(e,t){return t.findIndex((function(t){return null!=e[t][a.NotEqualTo]}))>=0},n=function(e,t){var r;return t.forEach((function(t){null!=(r=e[t])[a.NotEqualTo]&&(e[t][a.GreaterThan]=r[a.NotEqualTo],void 0===e[a.Or]?(e[a.Or]={},e[a.Or][t]={}):void 0===e[a.Or][t]&&(e[a.Or][t]={}),e[a.Or][t][a.LessThan]=r[a.NotEqualTo],delete e[t][a.NotEqualTo])})),e};switch(T(t)){case i.Object:var o=Object.keys(t);if(r(t,o))if(1===o.length)e.where=n(t,o);else{var u=[];o.forEach((function(e){var r;u.push(n(((r={})[e]=t[e],r),[e]))})),e.where=u}break;default:var s=[];t.forEach((function(e){var t=Object.keys(e);r(e,t)&&(e=n(e,t)),s.push(e)})),e.where=s}},e.prototype.checkInsertQuery=function(e){var t=this.isInsertQryValid(e),r=t.table,n=t.log;if(n)return n;if(!e.skipDataCheck){var o=new S(r,r.autoIncColumnValue).checkAndModifyValues(e),i=o.values,u=o.err;return e.values=i,u}},e}(),O=(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),I=function(e){function t(t,r){var n=e.call(this)||this;return n.valuesAffected_=[],null==t.validation&&(t.validation=!0),n.query=t,n.util=r,n.tableName=t.into,n}return O(t,e),t.prototype.execute=function(e){var t=this,r=new C(e).validate(u.Insert,this.query);return r?w(r):this.insertData_(e).then((function(e){return t.query.return?t.valuesAffected_:t.rowAffected})).catch((function(e){return t.util.abortTransaction(),w(e)}))},t.prototype.insertData_=function(e){var t,r,n,o=this,i=this.query;return t=i.return?function(e){o.valuesAffected_.push(e)}:function(e){++o.rowAffected},n=i.upsert?"put":"add",r=i.ignore&&!o.isTxQuery?function(e){return o.util.con.transaction(i.into,c.ReadWrite).objectStore(i.into)[n](e)}:(o.isTxQuery||o.util.createTransaction([i.into,v.tableName]),o.objectStore=o.util.objectStore(o.tableName),function(e){return o.objectStore[n](e)}),_(i.values.map((function(e){return p((function(n,o){var u=r(e);u.onerror=function(e){i.ignore?n():o(e)},u.onsuccess=function(){t(e),n()}}))}))).then((function(){v.set(v.dbSchema,e,o.util)}))},t}(k),j=void 0===self.alert&&"undefined"==typeof ServiceWorkerGlobalScope,A=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch(e){return!1}return!0}(),N=function(e){return Object.keys(e)},R=function(e){return Array.isArray(e)},Q=function(e){return N(e).length},D=function(e){for(var t in e)return t},L=function(){function e(){}return e.prototype.setCaseAndValue=function(e,t){this.caseQuery_=e,this.setValue(t)},e.prototype.setCaseAndColumn=function(e,t){return this.caseQuery_=e,this.setColumn(t),this},e.prototype.setColumn=function(e){return this.columnName_=e,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.evaluate=function(){for(var e=0;e<this.length_;e++)if(!0===this.checkCase_(this.caseColumnQuery_[e]))return this.caseColumnQuery_[e].then;var t=this.caseColumnQuery_[this.length_-1].then;return null==t?this.value[this.columnName_]:t},e.prototype.checkCase_=function(e){var t;for(t in e){switch(t){case a.GreaterThan:if(this.value[this.columnName_]>e[t])return!0;break;case a.Equal:if(this.value[this.columnName_]===e[t])return!0;break;case a.LessThan:if(this.value[this.columnName_]<e[t])return!0;break;case a.GreaterThanEqualTo:if(this.value[this.columnName_]>=e[t])return!0;break;case a.LessThanEqualTo:if(this.value[this.columnName_]<=e[t])return!0;break;case a.NotEqualTo:if(this.value[this.columnName_]!==e[t])return!0;break;case a.Between:if(this.value[this.columnName_]>e[t].low&&this.value[this.columnName_]<e[t].high)return!0}return!1}},e}(),V=function(e){var t,r=this,n=!1;return function(o){(t=o.target.result)?n&&r.results.length!==r.limitRecord?(r.pushResult(t.value),t.continue()):(n=!0,t.advance(r.skipRecord)):e()}},W=function(e){var t,r=this,n=!1;return function(o){(t=o.target.result)?n?(r.pushResult(t.value),t.continue()):(n=!0,t.advance(r.skipRecord)):e()}},B=function(e){var t,r=this;return function(n){(t=n.target.result)?(r.pushResult(t.value),t.continue()):e()}},P=function(e){var t,r=this;return function(n){(t=n.target.result)&&r.results.length!==r.limitRecord?(r.pushResult(t.value),t.continue()):e()}},U=function(e){return e.replace(/\s/g,"")},G=function(e){var t;if(null==this.query.join)t=this.getColumnInfo(e);else{var r=U(e).split(".");e=r[1],t=this.getColumnInfo(e,r[0])}if(null==t){var o=this.results[0][e];if(o)return{dataType:T(o),name:e};throw new m(n.ColumnNotExist,{column:e,isOrder:!0})}return t},F=function(e,t){return t.localeCompare(e)},K=function(e,t){return e.localeCompare(t)},J=function(e,t){return new String(t).localeCompare(e)},M=function(e,t){return new String(e).localeCompare(t)},z=function(e,t){return t-e},$=function(e,t){return e-t},H=function(e,t){return t.getTime()-e.getTime()},X=function(e,t){return e.getTime()-t.getTime()},Y=function(e,t,r){for(var n in r){this.thenEvaluator.setCaseAndValue(r,e);var o=this.thenEvaluator.setColumn(n).evaluate();this.thenEvaluator.setCaseAndValue(r,t);var u=this.thenEvaluator.setColumn(n).evaluate();switch(typeof e[o]){case i.String:return F(e[o],t[u]);default:return z(e[o],t[u])}}},Z=function(e,t,r){for(var n in r){this.thenEvaluator.setCaseAndValue(r,e);var o=this.thenEvaluator.setColumn(n).evaluate();this.thenEvaluator.setCaseAndValue(r,t);var u=this.thenEvaluator.setColumn(n).evaluate();switch(typeof e[o]){case i.String:return K(e[o],t[u]);default:return $(e[o],t[u])}}},ee=function(e,t){switch(e.dataType){case i.String:return"asc"===t.type?K:F;case i.Number:return"asc"===t.type?$:z;case i.DateTime:return"asc"===t.type?X:H;default:return"asc"===t.type?M:J}},te=function(e){var t,r=this;e.type=re(e.type);var n=e.by;if(null!=n&&typeof n===i.Object)"asc"===e.type?this.results.sort((function(e,t){return Z.call(r,e,t,n)})):this.results.sort((function(e,t){return Y.call(r,e,t,n)}));else{var o=G.call(this,n);if(null!=o){var u=ee(o,e);n=o.name,null==e.case?this.results.sort((function(e,t){return u(e[n],t[n])})):(this.thenEvaluator.setCaseAndColumn(((t={})[n]=e.case,t),n),this.results.sort((function(e,t){return u(r.thenEvaluator.setValue(e).evaluate(),r.thenEvaluator.setValue(t).evaluate())})))}}},re=function(e){return null==e?"asc":e.toLowerCase()},ne=function(e){var t=this,r=!1;return function(n){var o=n.target.result;if(o)if(r&&t.results.length!==t.limitRecord){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else r=!0,o.advance(t.skipRecord);else e()}},oe=function(e){var t=this,r=!1;return function(n){var o=n.target.result;if(o)if(r){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else r=!0,o.advance(t.skipRecord);else e()}},ie=function(e){var t=this;return function(r){var n=r.target.result;if(n&&t.results.length!==t.limitRecord){var o=n.value;t.shouldAddValue(o)&&t.pushResult(o),n.continue()}else e()}},ue=function(e){var t=this;return function(r){var n=r.target.result;if(n){var o=n.value;t.shouldAddValue(o)&&t.pushResult(o),n.continue()}else e()}},se=function(e){var t,r,n=e.split("%");switch(n[1]?(t=n[1],r=n.length>2?l.Any:l.Last):(t=n[0],r=l.First),r){case l.First:return new RegExp("^"+t,"i");case l.Last:return new RegExp(t+"$","i");default:return new RegExp(""+t,"i")}},ae=function(e){return"object"===T(e)&&!(e instanceof RegExp)},ce=function(e){if(ae(e)){var t={};for(var r in e)t[r]=null!=e[r]&&ae(e[r])?ce(e[r]):e[r];return t}return e},le=function(e,t,r){var n=T(e);if(n!==T(t))return!1;switch(n===i.DateTime&&(e=e.getTime(),t=t.getTime()),r){case a.GreaterThan:return e>t;case a.LessThan:return e<t;case a.LessThanEqualTo:return e<=t;case a.GreaterThanEqualTo:return e>=t;case a.NotEqualTo:return e!==t;default:return e===t}},he=function(){function e(e,t){this.where=ce(e),this.checkFlag=t}return e.prototype.remove=function(e){var t=e.pop();delete e.reduce((function(e,t){return e&&e[t]}),this.where)[t]},e.prototype.check=function(e){var t=!0;if(!this.checkFlag)return t;for(var r in this.where){if(!t)return t;var n=this.where[r],o=e[r];if("object"===T(n))for(var i in n){if(!t)return t;switch(i){case a.In:t=this.checkIn(r,o);break;case a.Like:t=this.checkLike_(r,o);break;case a.Regex:t=this.checkRegex(r,o);break;case a.Between:case a.GreaterThan:case a.LessThan:case a.GreaterThanEqualTo:case a.LessThanEqualTo:case a.NotEqualTo:t=this.checkComparisionOp_(r,o,i);break;default:t=!1}}else t=le(n,o)}return t},e.prototype.checkIn=function(e,t){return null!=this.where[e][a.In].find((function(e){return le(e,t)}))},e.prototype.checkLike_=function(e,t){return se(this.where[e][a.Like]).test(t)},e.prototype.checkRegex=function(e,t){return this.where[e][a.Regex].test(t)},e.prototype.checkComparisionOp_=function(e,t,r){var n=this.where[e][r];return r!=a.Between?le(t,n,r):le(t,n.low,">=")&&le(t,n.high,"<=")},e}(),fe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shouldEvaluateLimitAtEnd=!1,t.shouldEvaluateSkipAtEnd=!1,t}return fe(t,e),t.prototype.goToWhereLogic=function(){var e=this.query,t=D(e.where);if(!this.objectStore.indexNames.contains(t)){var r=this.getColumnInfo(t),o=new m(null==r?n.ColumnNotExist:n.EnableSearchOff,{column:t});return w(o)}var i=e.where[t];if("object"!==T(i)){u=Q(e.where)>1;return this.whereCheckerInstance=new he(e.where,u),this.whereCheckerInstance.remove([t]),this.executeWhereLogic(t,i,null,"next")}var u=Q(i)>1||Q(e.where)>1;this.whereCheckerInstance=new he(e.where,u);var s=D(i);switch(this.whereCheckerInstance.remove([t,s]),s){case a.Like:var c=se(i[a.Like]);return this.executeRegexLogic(t,c);case a.Regex:return this.executeRegexLogic(t,i[a.Regex]);case a.In:return this.executeInLogic(t,i[a.In]);case a.Between:case a.GreaterThan:case a.LessThan:case a.GreaterThanEqualTo:case a.LessThanEqualTo:return this.executeWhereLogic(t,i,s,"next");case a.Aggregate:break;default:return this.executeWhereLogic(t,i,null,"next")}},t}(k),de=function(e,t){var r=this;return function(n){var o=n.target.result;if(r.results.length!==r.limitRecord&&o){var i=o.value;r.shouldAddValue(i)&&t(i),o.continue()}else e()}},ye=function(e,t){var r=this;return function(n){var o=n.target.result;if(o){var i=o.value;r.shouldAddValue(i)&&t(i),o.continue()}else e()}},ve=function(e){var t=this;return function(r){var n=r.target.result;if(n){var o=n.value;t.shouldAddValue(o)&&t.pushResult(o),n.continue()}else e()}},be=function(e,t){var r=this;return function(n){var o=n.target.result;r.results.length!==r.limitRecord&&o?(r.shouldAddValue(o)&&t(o.value),o.continue()):e()}},me=function(e,t){var r=this;return function(n){var o=n.target.result;o?(r.shouldAddValue(o)&&t(o.value),o.continue()):e()}},ge=function(e){var t=this;return function(r){var n=r.target.result;t.results.length!==t.limitRecord&&n?(t.shouldAddValue(n)&&t.pushResult(n.value),n.continue()):e()}},_e=function(e){var t=this;return function(r){var n=r.target.result;n?(t.shouldAddValue(n)&&t.pushResult(n.value),n.continue()):e()}},we=function(){return(we=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},xe=function(){function e(e){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=e}return Object.defineProperty(e.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),e.prototype.getTable=function(e){return this.select.table(e)},e.prototype.executeSelect=function(e){return new Se(e,this.select.util).execute(this.select.db)},e.prototype.execute=function(){var e=this,t=this.query;this.joinQueryStack_=T(t.join)===i.Object?[t.join]:t.join;for(var r=t.from,n=[r],o=0,u=this.joinQueryStack_.length;o<u;o++){var s=this.joinQueryStack_[o],a=this.getJoinTableInfo_(s.on);s.with===a.table1.table&&(a={table1:a.table2,table2:a.table1});var c=this.checkJoinQuery_(a,s);if(c)return w(c);this.joinQueryStack_[o].joinTableInfo=a,n.push(s.with)}return this.select.isTxQuery||this.select.util.createTransaction(n),this.executeSelect({from:r,where:t.where,case:t.case,flatten:t.flatten}).then((function(t){return e.results=t.map((function(t){var r;return(r={})[e.currentQueryStackIndex_]=t,r})),e.tablesFetched.push(r),e.startExecutingJoinLogic_()}))},e.prototype.onJoinQueryFinished_=function(){var e=this;if(this.results.length>0)try{var t=[],r=Object.keys(this.results[0]).length,o=function(e,t){if(null!=e.as)for(var r in e.as)void 0===t[e.as[r]]&&(t[e.as[r]]=t[r],delete t[r]);return t};this.results.forEach((function(n){for(var i=n[0],u=1;u<r;u++){var s=e.joinQueryStack_[u-1];i=we(we({},i),o(s,n[u]))}t.push(i)})),this.select.results=t,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null,this.select.processOrderBy(),this.select.processGroupDistinctAggr()}catch(e){return w(new m(n.InvalidJoinQuery,e.message))}},e.prototype.startExecutingJoinLogic_=function(){var e=this,t=this.joinQueryStack_[this.currentQueryStackIndex_];if(!t)return this.onJoinQueryFinished_();try{var r=t.joinTableInfo;return this.executeSelect({from:t.with,where:t.where,case:t.case,flatten:t.flatten}).then((function(n){return e.jointables(t.type,r,n),e.tablesFetched.push(r.table2.table),++e.currentQueryStackIndex_,e.startExecutingJoinLogic_()}))}catch(e){return w(new m(n.InvalidJoinQuery,e.message))}},e.prototype.jointables=function(e,t,r){var n,o,i,u,s=this,a=[],c=t.table1.column,l=t.table2.column,h=this.tablesFetched.indexOf(t.table1.table),f=this.currentQueryStackIndex_+1;switch(e){case"left":i=0,u={},s.getTable(t.table2.table).columns.forEach((function(e){u[e.name]=null})),s.results.forEach((function(e){n=[],o=1===f?function(t){e[h][c]===t[l]&&n.push(t)}:function(t){var r=e[h];null!=r&&r[c]===t[l]&&n.push(t)},r.forEach(o),0===n.length&&(n=[u]),n.forEach((function(t){a[i]=we({},e),a[i++][f]=t}))}));break;default:!function(){var e=0;s.results.forEach((function(t){r.forEach((function(r){t[h][c]===r[l]&&(a[e]=we({},t),a[e++][f]=r)}))}))}()}this.results=a},e.prototype.getJoinTableInfo_=function(e){var t=(e=U(e)).split("="),r=t[0].split("."),n=t[1].split(".");return{table1:{table:r[0],column:r[1]},table2:{table:n[0],column:n[1]}}},e.prototype.checkJoinQuery_=function(e,t){var r,o=e.table1,i=e.table2,u=this.getTable(o.table),s=this.getTable(i.table);return t.with!==i.table&&(r=new m(n.InvalidJoinQuery,"on value should contains value of with")),null==u.columns.find((function(e){return e.name===o.column}))?r=new m(n.InvalidJoinQuery,"column "+o.column+" does not exist in table "+o.table):null==s.columns.find((function(e){return e.name===i.column}))&&(r=new m(n.InvalidJoinQuery,"column "+i.column+" does not exist in table "+i.table)),null==t.as&&(t.as={}),u.columns.every((function(e){var u=s.columns.find((function(t){return t.name===e.name&&t.name!==o.column}));return null==u||null!=t.as[u.name]||(r=new m(n.InvalidJoinQuery,"column "+e.name+" exist in both table "+o.table+" & "+i.table),!1)})),r},e}(),ke=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Te=function(){return(Te=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ee=function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e},Se=function(e){function t(t,r){var n=e.call(this)||this;return n.sorted=!1,n.isSubQuery=!1,n.thenEvaluator=new L,n.returnResult_=function(){if(n.query.flatten){var e=[],t={};n.query.flatten.forEach((function(r){n.results.forEach((function(n,o){n[r].forEach((function(t){var o;e.push(Te(Te({},n),((o={})[r]=t,o)))})),t[o]=!0}))}));var r=0;N(t).forEach((function(e){n.results.splice(Number(e)-r,1),++r})),n.results=n.results.concat(e)}return n.processGroupDistinctAggr(),n.processOrderBy(),n.shouldEvaluateSkipAtEnd&&n.results.splice(0,n.query.skip),n.shouldEvaluateLimitAtEnd&&(n.results=n.results.slice(0,n.query.limit)),n.results},n.query=t,n.util=r,n.tableName=t.from,n.setPushResult(),R(n.query.where)?(n.isArrayQry=!0,n.setLimitAndSkipEvaluationAtEnd_()):(n.skipRecord=t.skip,n.limitRecord=t.limit),t.order?((R(t.order)||t.order.case||"object"==typeof t.order.by)&&(n.query.order.idbSorting=!1),n.setLimitAndSkipEvaluationAtEnd_()):t.groupBy&&n.setLimitAndSkipEvaluationAtEnd_(),n}return ke(t,e),t.prototype.execute=function(e){this.db=e;try{var t=new C(e).validate(u.Select,this.query);return t?w(t):(this.initTransaction_(),(null==this.query.join?null!=this.query.where?R(this.query.where)?this.processWhereArrayQry():this.processWhere_():this.executeWhereUndefinedLogic():this.executeJoinQuery()).then(this.returnResult_.bind(this)))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var t,r=this.query.where,n=this.primaryKey(),o=!0,i=[],u=function(){if(t===a.And){!0===o?i=e.results:i.length>0&&(u=[],e.results.forEach((function(e){var t;t=e[n],i.findIndex((function(e){return e[n]===t}))>=0&&u.push(e)})),i=u,u=null)}else i.length>0?(e.results=Ee(Ee([],i),e.results),e.removeDuplicates(),i=e.results):i=e.results;var u;if(o=!1,r.length>0)return e.results=[],s();e.results=i},s=function(){return e.query.where=r.shift(),e.query.where[a.Or]&&1===Q(e.query.where)?(t=a.Or,e.query.where=e.query.where[a.Or]):t=a.And,e.processWhere_().then(u)};return s()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],c.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(t){return e.whereCheckerInstance.check(t)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=Ee(Ee([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=D(this.orInfo.orQuery);if(null!=e){var t={};return t[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=t,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},delete e.or},t}(pe);Se.prototype.executeInLogic=function(e,t){var r=this,n=this.skipRecord,o=function(e){0===n?r.pushResult(e):--n},i=function(){if(!1===r.shouldEvaluateLimitAtEnd&&!1===r.shouldEvaluateSkipAtEnd){if(r.skipRecord&&r.limitRecord)return de;if(r.skipRecord)return ye;r.limitRecord}return ve}(),u=this.objectStore.index(e);return _(t.map((function(e){return t=e,p((function(e,n){var s=u.openCursor(r.util.keyRange(t));s.onsuccess=i.call(r,e,o),s.onerror=n}));var t})))},Se.prototype.executeWhereUndefinedLogic=function(){var e,t=this;if(this.query.order&&!1!==this.query.order.idbSorting&&this.query.order.by){if(!this.objectStore.indexNames.contains(this.query.order.by))return w(new m(n.ColumnNotExist,{column:this.query.order.by,isOrder:!0}));var r=this.query.order.type&&"desc"===this.query.order.type.toLowerCase()?"prev":"next";this.sorted=!0,e=this.objectStore.index(this.query.order.by).openCursor(null,r)}else e=this.objectStore.openCursor();var o=function(){if(!1===t.shouldEvaluateLimitAtEnd&&!1===t.shouldEvaluateSkipAtEnd){if(t.skipRecord&&t.limitRecord)return V;if(t.skipRecord)return W;if(t.limitRecord)return P}return B}();return p((function(r,n){e.onerror=n,e.onsuccess=o.call(t,r)}))},Se.prototype.executeWhereLogic=function(e,t,r,n){var o=this;t=r?t[r]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,r),n),u=function(){if(!1===o.shouldEvaluateLimitAtEnd&&!1===o.shouldEvaluateSkipAtEnd){if(o.skipRecord&&o.limitRecord)return ne;if(o.skipRecord)return oe;if(o.limitRecord)return ie}return ue}();return p((function(e,t){i.onerror=t,i.onsuccess=u.call(o,e)}))},Se.prototype.executeRegexLogic=function(e,t){var r=this,n=this.skipRecord,o=function(e){0===n?r.pushResult(e):--n};this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)};var i=this.objectStore.index(e).openCursor(),u=function(){if(!1===r.shouldEvaluateLimitAtEnd&&!1===r.shouldEvaluateSkipAtEnd){if(r.skipRecord&&r.limitRecord)return be;if(r.skipRecord)return me;if(r.limitRecord)return ge}return _e}();return p((function(e,t){i.onerror=t,i.onsuccess=u.call(r,e,o)}))},Se.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},Se.prototype.setPushResult=function(){var e=this;this.query.case?this.pushResult=function(t){var r;for(r in e.thenEvaluator.setCaseAndValue(e.query.case,t),e.query.case)t[r]=e.thenEvaluator.setColumn(r).evaluate();e.results.push(t)}:this.pushResult=function(t){e.results.push(t)}},Se.prototype.removeDuplicates=function(){var e=this.results;this.results=null;for(var t=this.primaryKey(),r={},n=0,o=e.length;n<o;n++)r[e[n][t]]=e[n];for(var n in e=[],r)e.push(r[n]);this.results=e},Se.prototype.executeJoinQuery=function(){return new xe(this).execute()},Se.prototype.processGroupDistinctAggr=function(){if(this.query.distinct){var e=[],t=this.results[0];for(var r in t)e.push(r);var n=this.primaryKey(),o=e.indexOf(n);e.splice(o,1),this.query.groupBy=e.length>0?e:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},Se.prototype.processOrderBy=function(){var e=this.query.order;if(e&&this.results.length>0&&!this.sorted){var t=T(e);if(t===i.Object)te.call(this,e);else if(t===i.Array){te.call(this,e[0]);for(var r=function(t,r){var o=e[t-1].by,i=e[t],u=i.by,s=G.call(n,u);if(null!=s){u=s.name,i.type=re(i.type);var a=ee(s,i);n.results.sort((function(e,t){return e[o]===t[o]?a(e[u],t[u]):0}))}},n=this,o=1,u=e.length;o<u;o++)r(o)}}},Se.prototype.processAggregateQry=function(){var e,t=this.results,r=t.length,n={};this.results=void 0;var o=function(){var r=0;for(var n in t)r+=t[n][e]?1:0;return r},u=function(){var r=0;for(var n in t)r=r>t[n][e]?r:t[n][e];return r},s=function(){var r=1/0,n=1/0;for(var o in t)r=r<(n=t[o][e]?t[o][e]:1/0)?r:n;return r},a=function(){var r=0;for(var n in t)r+=t[n][e];return r},c=function(){var n=0;for(var o in t)n+=t[o][e];return n/r};for(var l in this.query.aggregate){var h=this.query.aggregate[l],f=T(h),p=void 0;switch(l){case"count":p=o;break;case"max":p=u;break;case"min":p=s;break;case"sum":p=a;break;case"avg":p=c}switch(f){case i.String:n[l+"("+(e=h)+")"]=p();break;case i.Array:for(var d in h)n[l+"("+(e=h[d])+")"]=p()}}for(var l in n)t[0][l]=n[l];this.results=[t[0]]},Se.prototype.executeAggregateGroupBy=function(){var e=this.query.groupBy,t=this.results;this.results=void 0;var r,n,o,u,s={},c=this.query.aggregate,l=function(){var e=function(){return o=(o=s[n])?o["count("+u+")"]:0,o+=t[r][u]?1:0},l=function(){return o=(o=s[n])?o["max("+u+")"]:0,t[r][u]=t[r][u]?t[r][u]:0,o>t[r][u]?o:t[r][u]},h=function(){return o=(o=s[n])?o["min("+u+")"]:1/0,t[r][u]=t[r][u]?t[r][u]:1/0,o<t[r][u]?o:t[r][u]},f=function(){return o=(o=s[n])?o["sum("+u+")"]:0,o+=t[r][u]?t[r][u]:0},p=function(){var e=(o=s[n])?o["sum("+u+")"]:0;e+=t[r][u]?t[r][u]:0,t[r]["sum("+u+")"]=e,o=o?o["count("+u+")"]:0,o+=t[r][u]?1:0,t[r]["count("+u+")"]=o};for(var d in c){var y=c[d],v=T(y),b=void 0;switch(d){case a.Count:b=e;break;case a.Max:b=l;break;case a.Min:b=h;break;case a.Sum:b=f;break;case a.Avg:b=p}switch(v){case i.String:u=y,t[r][d+"("+u+")"]=b();break;case i.Array:for(var m in y)u=y[m],t[r][d+"("+u+")"]=b()}}};if(T(e)===i.String)for(r in t)n=t[r][e],l(),s[n]=t[r];else for(r in t){for(var h in n="",e)n+=t[r][e[h]];l(),s[n]=t[r]}for(var f in t=[],s)t.push(s[f]);if(c.avg)if(T(c.avg)===i.String)for(r in t){var p=t[r]["sum("+c.avg+")"],d=t[r]["count("+c.avg+")"];t[r]["avg("+c.avg+")"]=p/d,c.count!==c.avg&&delete t[r]["count("+c.avg+")"],c.sum!==c.avg&&delete t[r]["sum("+c.avg+")"]}else{var y=T(c.count)===i.String,v=T(c.sum)===i.String;for(r in t)for(var h in c.avg){var b=c.avg[h],m=t[r]["sum("+b+")"],g=t[r]["count("+b+")"];t[r]["avg("+b+")"]=m/g,y&&(c.count!==b||-1===c.count.indexOf(b))&&delete t[r]["count("+b+")"],v&&(c.sum!==b||-1===c.sum.indexOf(b))&&delete t[r]["sum("+b+")"]}}this.results=t},Se.prototype.processGroupBy=function(){var e=this.query.groupBy,t=this.results,r={};if(this.results=this.query.groupBy=null,T(e)!==i.Object)if(T(e)===i.String)for(var n in t)r[t[n][e]]=t[n];else{var o=void 0;for(var n in t){for(var u in o="",e)o+=t[n][e[u]];r[o]=t[n]}}else if(1===Object.keys(e).length){var s=D(e);for(var n in this.thenEvaluator.setCaseAndColumn(e,s),t)r[this.thenEvaluator.setValue(t[n]).evaluate()]=t[n]}else{o=void 0;for(var n in t){for(var u in o="",this.thenEvaluator.setCaseAndValue(e,t[n]),e)o+=this.thenEvaluator.setColumn(u).evaluate();r[o]=t[n]}}for(var n in t=[],r)t.push(r[n]);this.results=t};var qe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ce=function(e){function t(t,r){var n=e.call(this)||this;return n.resultCount=0,n.query=t,n.util=r,n.tableName=t.from,n}return qe(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r=new C(e),n=this.query,o=r.validate(u.Count,n);if(o)return w(o);try{var i=function(){var r=new Se(t.query,t.util);return r.isTxQuery=t.isTxQuery,r.execute(e).then((function(e){t.resultCount=e.length}))};return this.initTransaction_(),(null==n.join?null!=n.where?n.where.or||R(this.query.where)?i():this.goToWhereLogic():this.executeWhereUndefinedLogic():i()).then((function(e){return t.resultCount}))}catch(e){this.onException(e)}},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],c.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(pe);Ce.prototype.executeWhereUndefinedLogic=function(){var e,t,r=this,n=r.objectStore.count?(e=r.objectStore.count(),function(t){return function(){r.resultCount=e.result,t()}}):(e=r.objectStore.openCursor(),function(e){return function(n){(t=n.target.result)?(++r.resultCount,t.continue()):e()}});return p((function(t,r){e.onerror=r,e.onsuccess=n(t)}))},Ce.prototype.executeWhereLogic=function(e,t,r){var n,o,i=this;return t=r?t[r]:t,p((function(u,s){1===Q(i.query.where)&&i.objectStore.count?(n=i.objectStore.index(e).count(i.util.keyRange(t,r))).onsuccess=function(){i.resultCount=n.result,u()}:(n=i.objectStore.index(e).openCursor(i.util.keyRange(t,r))).onsuccess=function(e){(o=e.target.result)?(i.whereCheckerInstance.check(o.value)&&++i.resultCount,o.continue()):u()},n.onerror=s}))},Ce.prototype.executeRegexLogic=function(e,t){var r,n=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)},p((function(e,t){o.onerror=t,o.onsuccess=function(t){(r=t.target.result)?(n.shouldAddValue(r)&&++n.resultCount,r.continue()):e()}}))},Ce.prototype.executeInLogic=function(e,t){var r,n=this,o=this.objectStore.index(e);return _(t.map((function(e){return t=e,i=n.util.keyRange(t),n.objectStore.count?p((function(e,t){var r=o.count(i);r.onsuccess=function(t){n.resultCount+=t.target.result,e()},r.onerror=t})):p((function(e,t){var u=o.openCursor(i);u.onsuccess=function(t){(r=t.target.result)?(n.whereCheckerInstance.check(r.value)&&++n.resultCount,r.continue()):e()},u.onerror=t}));var t,i})))};var Oe=function(e,t){for(var r in e)if(T(e[r])!==i.Object)t[r]=e[r];else for(var n in e[r]){switch(n){case"+":t[r]+=e[r][n];break;case"-":t[r]-=e[r][n];break;case"*":t[r]*=e[r][n];break;case"/":t[r]/=e[r][n];break;case"{push}":t[r].push(e[r][n]);break;default:t[r]=e[r]}break}return t},Ie=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),je=function(e){function t(t,r){var n=e.call(this)||this;return n.query=t,n.util=r,n.tableName=t.in,n}return Ie(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r=this.query;try{var n=new C(e).validate(u.Update,r);if(n)return w(n);this.initTransaction();return(null!=r.where?r.where.or||R(r.where)?this.executeComplexLogic_():this.goToWhereLogic():this.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}catch(e){return this.onException(e)}},t.prototype.executeComplexLogic_=function(){var e=this,t=this.query,r=new Se({from:t.in,where:t.where,ignoreCase:t.ignoreCase},this.util);return r.isTxQuery=this.isTxQuery,r.execute(this.db).then((function(r){var n,o,i=e.primaryKey(t.in),u=[];r.forEach((function(e){u.push(e[i])})),r=null;var s=((n={})[i]=((o={})[a.In]=u,o),n);return e.query.where=s,e.initTransaction(),e.goToWhereLogic()}))},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(pe);je.prototype.executeWhereUndefinedLogic=function(){var e=this,t=this.objectStore.openCursor(),r=this.query.set;return p((function(n,o){t.onsuccess=function(t){var i=t.target.result;if(i)try{var u=i.update(Oe(r,i.value));u.onsuccess=function(){++e.rowAffected,i.continue()},u.onerror=o}catch(e){o(e)}else n()},t.onerror=o}))},je.prototype.executeWhereLogic=function(e,t,r){var n=this;t=r?t[r]:t;var o=this.objectStore.index(e).openCursor(this.util.keyRange(t,r)),i=this.query.set;return p((function(e,t){o.onsuccess=function(r){var o=r.target.result;if(o)if(n.whereCheckerInstance.check(o.value))try{var u=o.update(Oe(i,o.value));u.onsuccess=function(){++n.rowAffected,o.continue()},u.onerror=t}catch(e){t(e)}else o.continue();else e()},o.onerror=t}))},je.prototype.executeRegexLogic=function(e,t){var r,n=this,o=this.objectStore.index(e).openCursor();this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)};var i=this.query.set;return p((function(e,t){o.onsuccess=function(o){if(r=o.target.result)if(n.shouldAddValue(r))try{var u=r.update(Oe(i,r.value));u.onsuccess=function(){++n.rowAffected,r.continue()},u.onerror=t}catch(e){t(e)}else r.continue();else e()},o.onerror=t}))},je.prototype.executeInLogic=function(e,t){var r=this,n=this.objectStore.index(e),o=this.query;return _(t.map((function(e){return t=e,p((function(e,i){var u=n.openCursor(r.util.keyRange(t));u.onsuccess=function(t){var n=t.target.result;if(n){var u=n.value;if(r.whereCheckerInstance.check(u))try{var s=n.update(Oe(o.set,u));s.onsuccess=function(){++r.rowAffected,n.continue()},s.onerror=i}catch(e){i(e)}else n.continue()}else e()},u.onerror=i}));var t})))};var Ae=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ne=function(){return(Ne=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Re=function(e){function t(t,r){var n=e.call(this)||this;return n.query=t,n.util=r,n}return Ae(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r,n,o=this.query,i=0,u={},s={},a=!0,c=o.queries,l=c.length;if(c.every((function(e,t){return!(t+1<l&&e.from!==c[t+1].from)||(a=!1,!1)})),a){var h=this.primaryKey(c[0].from);r=function(e){return e[h]}}else r=function(e){var t="";for(var r in e)t+=e[r];return t};var f=function(){if(i<l)return(n=new Se(c[i],t.util)).execute(t.db).then((function(e){return u={},e.forEach((function(e){var t=r(e);0===i?s[t]=e:null!=s[t]&&(u[t]=e)})),i>0&&(s=Ne({},u)),++i,f()}));var e,a=[],h=void 0,p=o.skip,d=o.limit,y=!1,v=function(){a.push(u[e])},b=function(){a.length<d?v():y=!0},m=function(e){0===p?e():--p};if(h=o.skip&&o.limit?function(){m((function(){b()}))}:o.limit?b:o.skip?function(){m((function(){v()}))}:function(){v()},d){for(e in u)if(h(e),y)break}else for(e in u)h(e);return n.results=a,Object.assign(n.query,{order:o.order,join:{}}),n.processOrderBy(),n.processGroupDistinctAggr(),n.results};return f()},t}(k),Qe=function(){function e(){}return e.prototype.execute=function(e){return p((function(t,r){var o=indexedDB.deleteDatabase(e);o.onblocked=function(){var e=new m(n.DbBlocked);return r(x(e))},o.onerror=function(e){return r(x(e))},o.onsuccess=function(){t()}}))},e}(),De=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Le=function(e){function t(t,r){var n=e.call(this)||this;return n.query=t,n.util=r,n}return De(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r,n=this.query,o=0,i={},u=!0,s=n.length;if(n.every((function(e,t){return!(t+1<s&&e.from!==n[t+1].from)||(u=!1,!1)})),u){var a=this.primaryKey(n[0].from);r=function(e){return e[a]}}else r=function(e){var t="";for(var r in e)t+=e[r];return t};var c=function(){if(o<n.length)return new Se(n[o++],t.util).execute(e).then((function(e){return e.forEach((function(e){i[r(e)]=e})),c()}));var u=[];for(var s in i)u.push(i[s]);return u};return c()},t}(k),Ve=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),We=function(e){function t(t,r){var n=e.call(this)||this;return n.query=t,n.util=r,n.tableName=t.from,n}return Ve(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r=new C(e),n=this.query,o=r.validate(u.Remove,n);if(o)return w(o);try{this.initTransaction_();return(null!=n.where?R(n.where)?this.processWhereArrayQry():this.processWhere_():this.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this,t=new Se(this.query,this.util);return t.isTxQuery=this.isTxQuery,t.execute(this.db).then((function(t){var r,n,o=[],i=e.primaryKey(e.query.from);t.forEach((function(e){o.push(e[i])})),t=null;var u=((r={})[i]=((n={})[a.In]=o,n),r);return e.query[a.Where]=u,e.processWhere_()}))},t.prototype.processWhere_=function(){var e=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,t=D(this._orInfo.OrQuery);if(null!=t){var r={};return r[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this.query.where=r,this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(pe);We.prototype.executeInLogic=function(e,t){var r=this,n=this.objectStore.index(e);return _(t.map((function(e){return t=e,p((function(e,o){var i=n.openCursor(r.util.keyRange(t));i.onsuccess=function(t){var n=t.target.result;n?(r.whereCheckerInstance.check(n.value)&&(n.delete(),++r.rowAffected),n.continue()):e()},i.onerror=o}));var t})))},We.prototype.executeWhereUndefinedLogic=function(){var e,t=this,r=this.objectStore.openCursor();return p((function(n,o){r.onsuccess=function(r){(e=r.target.result)?(e.delete(),++t.rowAffected,e.continue()):n()},r.onerror=o}))},We.prototype.executeWhereLogic=function(e,t,r){var n,o,i=this;return t=r?t[r]:t,o=this.objectStore.index(e).openCursor(this.util.keyRange(t,r)),p((function(e,t){o.onsuccess=function(t){(n=t.target.result)?(i.whereCheckerInstance.check(n.value)&&(n.delete(),++i.rowAffected),n.continue()):e()},o.onerror=t}))},We.prototype.executeRegexLogic=function(e,t){var r,n=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)},p((function(e,t){o.onsuccess=function(t){(r=t.target.result)?(n.shouldAddValue(r)&&(r.delete(),++n.rowAffected),r.continue()):e()},o.onerror=t}))};var Be=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pe=function(e){function t(t,r){var n=e.call(this)||this;return n.query=t,n.util=r,n.tableName=t,n}return Be(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r=this.query;this.isTxQuery||this.util.createTransaction([r,v.tableName]);var n=this.util.objectStore(r).clear();try{return p((function(o,i){n.onsuccess=function(n){var u=t.table(r);for(var s in u.autoIncColumnValue)u.autoIncColumnValue[s]=0;v.set(v.dbSchema,e,t.util).then((function(){o()})).catch(i)},n.onerror=i}))}catch(e){return this.onException(e)}},t}(k),Ue=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ge=function(e){function t(t,r){var n=e.call(this)||this;return n.results={},n.reqQueue=[],n.isQueryExecuting=!1,n.isTxStarted_=!1,n.query=t,n.util=r,n}return Ue(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var r=this.validate();return r?w(r):(this.startExecution_(),p((function(e,r){t.onSuccess=e,t.onError=r})).then((function(e){return t.log("transaction finished"),e})))},t.prototype.validate=function(){var e=this.query,t=this.notExistingTable_(e.tables);if(t)return new m(n.TableNotExist,{tableName:t});var r=e.method;return self[r]?void 0:new m(n.MethodNotExist,r)},t.prototype.startExecution_=function(){var e=this,t=this.query,r=t.method,n=self[r];return this.log("transaction query started"),n.call(this,{data:t.data,insert:function(t){return e.pushReq_({name:u.Insert,query:t})},select:function(t){return e.pushReq_({name:u.Select,query:t})},update:function(t){return e.pushReq_({name:u.Update,query:t})},remove:function(t){return e.pushReq_({name:u.Remove,query:t})},count:function(t){return e.pushReq_({name:u.Count,query:t})},setResult:function(t,r){e.results[t]=r},getResult:function(t){return e.results[t]},abort:function(t){e.abortTx_(t)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var t=this.query.tables;return t=t.concat(v.tableName),this.util.createTransaction(t).then((function(t){e.onSuccess(e.results)})).catch((function(t){e.onError(t)})),this.processExecutionOfQry_()}catch(e){this.onError(this.onException(e))}},t.prototype.onReqFinished_=function(e){var t=this.reqQueue.shift();this.log("finished request : "+t.name+" "),t&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,t.onSuccess&&t.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : "+e)},t.prototype.executeRequest_=function(e){var t;this.isQueryExecuting=!0,this.log("executing request : "+e.name+" ");var r=this.onReqFinished_.bind(this),n=e.query;switch(e.name){case u.Select:t=new Se(n,this.util);break;case u.Insert:t=new I(n,this.util);break;case u.Update:t=new je(n,this.util);break;case u.Remove:t=new We(n,this.util);break;case u.Count:t=new Ce(n,this.util)}t.isTxQuery=!0,t.execute(this.db).then(r).catch((function(e){r({error:e})}))},t.prototype.pushReq_=function(e){var t=this,r=function(){t.reqQueue.push(e)},n=p((function(t,r){e.onSuccess=function(e){t(e)},e.onError=function(e){r(e)}}));return!0===this.isTxStarted_?(r(),this.processExecutionOfQry_()):r(),this.log("request pushed : "+e.name),n},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var t=this,r=null;return e.every((function(e){return null!=t.table(e)||(r=e,!1)})),r},t}(k),Fe=function(){function e(e){this.onQryFinished=j?function(e){self.postMessage(e)}:e}return Object.defineProperty(e.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),e.prototype.run=function(e){var t,r=this,n=e.query;switch(e.name){case u.OpenDb:t=this.openDb(n);break;case u.InitDb:t=this.initDb(n);break;case u.CloseDb:t=this.closeDb();break;case u.Insert:t=new I(n,this.util).execute(this.db);break;case u.Select:t=new Se(n,this.util).execute(this.db);break;case u.Count:t=new Ce(n,this.util).execute(this.db);break;case u.Update:t=new je(n,this.util).execute(this.db);break;case u.Intersect:t=new Re(n,this.util).execute(this.db);break;case u.DropDb:t=this.dropDb();break;case u.Terminate:t=this.terminate();break;case u.Union:t=new Le(n,this.util).execute(this.db);break;case u.Remove:t=new We(n,this.util).execute(this.db);break;case u.Clear:t=new Pe(n,this.util).execute(this.db);break;case u.Transaction:t=new Ge(n,this.util).execute(this.db);break;case u.Get:t=v.get(n,this.util);break;case u.Set:t=v.set(n.key,n.value,this.util);break;case u.ImportScripts:t=this.importScripts_(e);break;case u.ChangeLogStatus:this.logger.status=n,t=Promise.resolve();break;default:0,t=Promise.resolve()}this.logger.log("Executing query "+e.name+" in web worker"),t.then((function(e){r.returnResult_({result:e})})).catch((function(e){var t={error:x(e)};r.returnResult_(t)}))},e.prototype.importScripts_=function(e){return p((function(t,r){try{importScripts.apply(void 0,e.query),t()}catch(e){r(new m(n.ImportScriptsFailed,e.message))}}))},e.prototype.returnResult_=function(e){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(e)},e.prototype.dropDb=function(){var e=this.db.name;return this.terminate().then((function(){return(new Qe).execute(e)}))},e.prototype.closeDb=function(){return this.util.close()},e.prototype.terminate=function(){var e=this;return this.closeDb().then((function(){e.db=null}))},e.prototype.openDb=function(e){var t=this;return(this.db&&e.name===this.db.name?this.initDb():this.initDb({name:e.name,tables:[],version:e.version})).then((function(){return t.db}))},e.prototype.initDb=function(e){var t=this;if(!A)return w(new m(n.IndexedDbNotSupported));var r=e?new b(e):this.db;this.util=new g(r);return p((function(e,n){t.util.initDb().then((function(e){return e||(n=e,p((function(e,o){v.get(v.dbSchema,t.util).then((function(i){var u,s=!1;if(i&&(u=i.version,i.tables.forEach((function(e,t){var n=r.tables[t];n&&(e.version<n.version?(n.state=f.Delete,s=!0,u<n.version&&(u=n.version)):n.state=null)}))),s)return r.version=u,void t.terminate().then((function(n){t.util=new g(r),t.util.initDb().then((function(t){e(t)})).catch(o)}));n||(t.db=i),e(n)}))})));var n})).then((function(n){n?v.set(v.dbSchema,r,t.util).then((function(){t.db=r,e(!0)})):e(!1)})).catch(n)}))},e}();if(j){var Ke=new Fe;self.onmessage=function(e){Ke.run(e.data)}}}});
//# sourceMappingURL=jsstore.worker.min.js.map